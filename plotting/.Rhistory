library(tidyverse)
library(ggpubr)
library(stringr)
library(pastecs)
library(ComplexUpset)
il17.upset <- read.xlsx("../shared_data/IL17_pathway_Pivot_PlusData_upset.xlsx", colNames=TRUE, rowNames=TRUE)
head(il17.upset)
il17.upset <- read.xlsx("../shared_data/IL17_pathway_Pivot_PlusData_upset.xlsx", colNames=TRUE, rowNames=TRUE)
il17.upset <- tibble::rownames_to_column(il17.upset, "Gene")
head(il17.upset)
il17.upset <- read.xlsx("../shared_data/IL17_pathway_Pivot_PlusData_upset.xlsx", colNames=TRUE, rowNames=TRUE)
il17.upset <- tibble::rownames_to_column(il17.upset, "Gene")
tool = colnames(il17.upset)[3:7]
tool
il17.upset <- read.xlsx("../shared_data/IL17_pathway_Pivot_PlusData_upset.xlsx", colNames=TRUE, rowNames=TRUE)
il17.upset <- tibble::rownames_to_column(il17.upset, "Gene")
tool = colnames(il17.upset)[3:7]
genes[tool] = genes[tool] == 1
il17.upset <- read.xlsx("../shared_data/IL17_pathway_Pivot_PlusData_upset.xlsx", colNames=TRUE, rowNames=TRUE)
il17.upset <- tibble::rownames_to_column(il17.upset, "Gene")
tool = colnames(il17.upset)[3:7]
Gene[tool] = Gene[tool] == 1
il17.upset <- read.xlsx("../shared_data/IL17_pathway_Pivot_PlusData_upset.xlsx", colNames=TRUE, rowNames=TRUE)
il17.upset <- tibble::rownames_to_column(il17.upset, "Gene")
tool <- colnames(il17.upset)[3:7]
Gene[tool] = Gene[tool] == 1
il17.upset <- read.xlsx("../shared_data/IL17_pathway_Pivot_PlusData_upset.xlsx", colNames=TRUE, rowNames=TRUE)
il17.upset <- tibble::rownames_to_column(il17.upset, "Gene")
tool <- colnames(il17.upset)[3:7]
il17.upset[tool] = il17.upset[tool] == 1
t(head(il17.upset[tool], 3))
set_size(8, 3)
#set_size(8, 3)
upset(il17.upset, tool, name='tool', width_ratio=0.1)
#set_size(8, 3)
upset(il17.upset, tool,annotations = list(
'FC'=(
# note that aes(x=intersection) is supplied by default and can be skipped
ggplot(mapping=aes(y=logFC))
# checkout ggbeeswarm::geom_quasirandom for better results!
+ geom_jitter(aes(color=logFC), na.rm=TRUE)
+ geom_violin(alpha=0.5, na.rm=TRUE)),
name='tool', width_ratio=0.1))
#set_size(8, 3)
upset(il17.upset, tool,annotations = 'FC'=(ggplot(mapping=aes(y=logFC))
#set_size(8, 3)
upset(il17.upset, tool,name='tool', width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
annotations = list(
'DEGdetail'=(
ggplot(mapping=aes(fill='DEGdetail'))
+ geom_bar(stat='count', position='fill')
+ scale_y_continuous(labels=scales::percent_format())
+ scale_fill_manual(values=c(
'R'='#E41A1C', 'PG'='#377EB8',
'PG-13'='#4DAF4A', 'NC-17'='#FF7F00'
))
+ ylab('MPAA Rating')
)
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
annotations = list(
'DEGdetail'=(
ggplot(mapping=aes(fill='DEGdetail'))
+ geom_bar(stat='count', position='fill')
+ scale_y_continuous(labels=scales::percent_format())
+ scale_fill_manual(values=c(
'Up'='#E41A1C', 'Down'='#377EB8','No'='#4DAF4A'
))
+ ylab('DEG')
)
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
annotations = list(
'DEGdetail'=(
ggplot(mapping=aes(fill=DEGdetail))
+ geom_bar(stat='count', position='fill')
+ scale_y_continuous(labels=scales::percent_format())
+ scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#4DAF4A'))
+ ylab('DEG')
)
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
annotations = list(
'DEGdetail'=(
ggplot(mapping=aes(fill=DEGdetail))
+ geom_bar(stat='count', position='fill')
#            + scale_y_continuous(labels=scales::percent_format())
+ scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#4DAF4A'))
+ ylab('DEG')
)
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
annotations = list(
'DEGdetail'=(
ggplot(mapping=aes(fill=DEGdetail))
+ geom_bar(stat='count', position='fill')
#            + scale_y_continuous(labels=scales::percent_format())
+ scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#4DAF4A'))
+ ylab('DEG')
)
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
annotations = list(
'DEGdetail'=(
ggplot(mapping=aes(fill=DEGdetail))
+ geom_bar(stat='count', position='fill')
#            + scale_y_continuous(labels=scales::percent_format())
+ scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#949191'))
+ ylab('DEG')
)
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
annotations = list(
'DEGdetail'=(
ggplot(mapping=aes(fill=DEGdetail))
+ geom_bar(stat='count', position='fill')
#            + scale_y_continuous(labels=scales::percent_format())
+ scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#B3B2B2'))
+ ylab('DEG')
)
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=DEGdetail)
) + scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#B3B2B2'
))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=DEGdetail,factor(DEGdetail, levels = c("Up","Down","No")))
) + scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#B3B2B2'
))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=DEGdetail)
) + scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#B3B2B2'
))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=DEGdetail)
) + scale_fill_manual(values=c('Up'='#E41A1C', 'Down'='#377EB8','No'='#B3B2B2'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=DEGdetail)
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=factor(DEGdetail))
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=factor(DEGdetail),position = position_dodge(preserve = 'single'))
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=factor(DEGdetail),position = position_dodge(preserve = 'Up'))
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=factor(DEGdetail),position = position_dodge(preserve = 'total'))
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=factor(DEGdetail))
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=factor(DEGdetail),levels = c("No","Up","Down"))
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Intersection size'=intersection_size(
counts=FALSE,
mapping=aes(fill=factor(DEGdetail))
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=factor(DEGdetail))
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
il17.upset$DEGdetail <- factor(il17.upset$DEGdetail, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=DEGdetail)
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
il17.upset <- read.xlsx("../shared_data/IL17_pathway_Pivot_PlusData_upset.xlsx", colNames=TRUE, rowNames=TRUE)
il17.upset <- tibble::rownames_to_column(il17.upset, "Gene")
tool <- colnames(il17.upset)[3:7]
il17.upset[tool] = il17.upset[tool] == 1
t(head(il17.upset[tool], 3))
#set_size(8, 3)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)
) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
width_ratio=0.1)
#set_size(8, 3)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8')),
set_sizes=(upset_set_size() + theme(axis.ticks.x=element_line()))
),
width_ratio=0.1)
#set_size(8, 3)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size()) + theme(axis.ticks.x=element_line()),
width_ratio=0.1)
?upset_set_size
#set_size(8, 3)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(), position = "right") + theme(axis.ticks.x=element_line()),
#set_size(8, 3)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size()) + theme(axis.ticks.x=element_line()),
width_ratio=0.1)
#set_size(8, 3)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(geom=geom_bar(width=0.4))) + theme(axis.ticks.x=element_line()),
width_ratio=0.1)
#set_size(8, 3)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(geom=geom_bar(width=0.4))) + theme(axis.ticks.x=element_line(),x=element_text(angle=90)),
width_ratio=0.1)
#set_size(8, 3)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(geom=geom_bar(width=0.4))) + theme(axis.ticks.x=element_line(),axis.text.x=element_text(angle=90)),
width_ratio=0.1)
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
il17.upset.plot <- upset(
il17.upset,
tool,
name='tool',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(geom=geom_bar(width=0.4))) + theme(axis.ticks.x=element_line(),axis.text.x=element_text(angle=90)),
width_ratio=0.1)
il17.upset.plot
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
il17.upset.plot <- upset(
il17.upset,
tool,
name='Tool Group',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(geom=geom_bar(width=0.4))) + theme(axis.ticks.x=element_line(),axis.text.x=element_text(angle=90)),
width_ratio=0.1)
il17.upset.plot
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
il17.upset.plot <- upset(
il17.upset,
tool,
name='Tool Group',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(geom=geom_bar(width=0.4))) + theme(axis.ticks.x=element_line(),axis.text.x=element_text(angle=90)),
width_ratio=0.1)
il17.upset.plot
pdf('il17.upset.pdf',width=6, height=4)
il17.upset.plot
dev.off()
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
il17.upset.plot <- upset(
il17.upset,
tool,
name='Tool Group',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(geom=geom_bar(width=0.4))) + theme(axis.ticks.x=element_line(),axis.text.x=element_text(angle=90)),
width_ratio=0.1)
il17.upset.plot
pdf('il17.upset.pdf',width=4, height=6)
il17.upset.plot
dev.off()
il17.upset$Direction <- factor(il17.upset$Direction, levels = c('No', 'Up', 'Down'))
il17.upset.plot <- upset(
il17.upset,
tool,
name='Tool Group',
base_annotations=list(
'Gene Counts'=intersection_size(
counts=FALSE,
mapping=aes(fill=Direction)) + scale_fill_manual(values=c('No'='#B3B2B2','Up'='#E41A1C', 'Down'='#377EB8'))
),
set_sizes=(upset_set_size(geom=geom_bar(width=0.4))) + theme(axis.ticks.x=element_line(),axis.text.x=element_text(angle=90)),
width_ratio=0.1)
il17.upset.plot
pdf('il17.upset.pdf',width=6, height=6)
il17.upset.plot
dev.off()
